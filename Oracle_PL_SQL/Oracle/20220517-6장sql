-- 서브쿼리 (하위쿼리)
select * from usertbl;
-- 김경호 키가 큰 사람의 이름과 키
select username,height from usertbl where height>177;
select username,height from usertbl 
where height>(select height from usertbl where username='김경호');
select height from usertbl where username='김경호';
-- 경남 키가 큰 사람의 이름 키
select * from usertbl where addr='경남';
select username,height from usertbl 
where height> any (select height from usertbl where addr='경남');
select username,height from usertbl 
where height>= all (select height from usertbl where addr='경남');
select username,height from usertbl 
where height = any (select height from usertbl where addr='경남');
select username,height from usertbl 
where height in (select height from usertbl where addr='경남');
-- 정렬하여 출력
-- order by - 오름차순
select * from usertbl;
-- 가입한 순서로 이름,가입날짜, 가입순
select username,mdate from usertbl order by mdate;
-- 내림 차순
select username,mdate from usertbl order by mdate desc;
-- 키순으로 내림차순 정렬, 이름은 오름차순
select username,height from usertbl 
order by height desc, username asc;
--중복된 것을 제외하고 조회 distinct
--회원들의 사는 지역을 조회
select distinct addr from usertbl;

select * from employees;
-- 가장 오래 근무한 상위 5명 조회
select * from
(select employee_id, hire_date
  FROM employees order by hire_date)
where rownum <=5;

select employee_id, hire_date
  FROM employees where rownum<=5;

-- 샘플데이터 랜덤으로 조회
-- sample(퍼센트)
-- 샘플로 직원의 아이디, 고용 날짜를 5%
select employee_id,hire_date from employees
sample(5);

select * from buytbl;
select * from usertbl;

-- 회원들(회원아이디,주문량)이 주문한 건수 조회

select userid,prodname,amount from buytbl order by userid;
select userid,amount from buytbl order by userid;
-- 회원들의 총 주문수를 조회
-- group by 와 함께 집계합수
select userid,sum(amount) from buytbl group by userid;
--집계합수
--avg()평균,min()최소값,max()최대값,count()행의 개수
select count(*) from usertbl;
-- as ~와 같이(a.k.a)
select userid as "사용자 아이디",sum(amount) as "총 구매 개수"  
from buytbl
group by userid;

-- 상품 판 평균 갯수
select avg(amount) from buytbl;
select avg(amount) as "평균 구매 개수" from buytbl;
select cast(avg(amount) as number(10,3)) as "평균 구매 개수" 
from buytbl;

-- 가장 큰키의 회원, 작은 키의 회원
select userName,height
from usertbl
where height=(select max(height) from usertbl)
or height=(select min(height) from usertbl);

select count(*) from usertbl;
select * from usertbl;
select count(mobile2) as "휴대폰 입력한 사용자" from usertbl;
-- 1000이상 구매 고객 사은품 증정 행사
select userid as "사용자", sum(price*amount) as "총 구매액"
from buytbl
--where sum(price*amount)>1000
group by userid;

--group by-> having, 집계함수
select userid as "사용자", sum(price*amount) as "총 구매액"
from buytbl
group by userid
having sum(price*amount)>1000;
-- 총합계 중간 합계
-- 분류 별로 합계 그 총합 구하고 싶다
select groupname,sum(price*amount) as "판매액"
from buytbl
group by rollup (groupname);



